<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyboard Control for Moving Box</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            background-image: url(bg.jpg);
            background-size: cover;
        }

        #player {
            width: 50px;
            height: 50px;
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5em;
        }

        #enemy {
            width: 50px;
            height: 50px;
            position: absolute;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 2.5em;
        }

        .bullet {
            width: 5px;
            height: 10px;
            background-color: red;
            position: absolute;
            left: 50%;
        }
        #score{
            font-size: 2em;
            color: yellow  ;
        }
    </style>
</head>

<body>
    <div id="score">Score: 0</div>
    <div id="player">&#x1F916;</div>
    <div id="enemy">ğŸ‘½</div>
    <script>
        const player = document.getElementById("player");
        const bullet = document.getElementById("bullet");
        const playerSpeed = 10;
        const bulletSpeed = 5;
        const bullets = [];
        //const enemySize = 50;
        let bulletInterval;

        alert("éŠæˆ²æ–¹å¼ï¼šå·¦å³éµæ§åˆ¶ç§»å‹•ï¼Œç©ºç™½éµç™¼å°„å­å½ˆï¼Œç²å¾—5åˆ†è´å¾—å‹åˆ©");
        document.addEventListener("keydown", function (event) {
            if (event.key === "ArrowLeft") {
                movePlayer(-playerSpeed, 0);
            } else if (event.key === "ArrowRight") {
                movePlayer(playerSpeed, 0);
            } else if (event.key === " ") {
                shootBullet();
            }
        });

        function movePlayer(deltaX, deltaY) {
            const playerRect = player.getBoundingClientRect();
            const newX = playerRect.left + player.offsetWidth / 2 + deltaX; 

            // æ£€æŸ¥æ˜¯å¦è¶…å‡ºå·¦å³è¾¹ç•Œ
            if (newX -5 >= 0 && newX + 15 <= window.innerWidth) {
                player.style.left = newX + "px";
            }
        }

        function shootBullet() {
            const bullet = document.createElement("div");
            bullet.className = "bullet";
            bullet.style.left = parseInt(player.style.left) + "px";
            bullet.style.bottom = player.offsetHeight + "px";
            document.body.appendChild(bullet);
            bullets.push(bullet);

            if (!bulletInterval) {
                bulletInterval = setInterval(moveBullets, 1000 / 60); // å­å½ˆé€Ÿåº¦ï¼Œæ¯ç§’60å¸§
            }
        }

        function moveBullets() {
        bullets.forEach(bullet => {
            const bottom = parseInt(bullet.style.bottom);
            bullet.style.bottom = bottom + bulletSpeed + "px";

            if (bottom > window.innerHeight) {
                bullet.remove();
                bullets.splice(bullets.indexOf(bullet), 1);
            } else {
                // æ£€æŸ¥å­å¼¹å’Œæ•Œäººæ˜¯å¦ç¢°æ’
                const bulletRect = bullet.getBoundingClientRect();
                const enemy = document.querySelector("#enemy");
                const enemyRect = enemy.getBoundingClientRect();
                if (
                    bulletRect.left < enemyRect.right &&
                    bulletRect.right > enemyRect.left &&
                    bulletRect.top < enemyRect.bottom &&
                    bulletRect.bottom > enemyRect.top
                ) {
                    // ç¢°æ’å‘ç”Ÿï¼Œç§»é™¤å­å¼¹å’Œæ•Œäºº
                    bullet.remove();
                    bullets.splice(bullets.indexOf(bullet), 1);
                    enemy.remove();
                    increaseScore();// å¢åŠ åˆ†æ•°
                    if(score >= 5){
                        alert("YOU WIN");
                    }
                    generateEnemy();
                }
            }
        });

        if (bullets.length === 0) {
            clearInterval(bulletInterval);
            bulletInterval = null;
        }
    }

    function generateEnemy() {
        const enemy = document.createElement("div");
        //const container = document.getElementById("container");
        enemy.id = "enemy";
        enemy.textContent = 'ğŸ‘½';
        enemy.style.left = Math.random() * (window.innerWidth - 50) + "px"; // éšæœºç”Ÿæˆä½ç½®
        document.body.appendChild(enemy);

    }

    let deltaX = 2;
    //let enemy = generateEnemy(); // ç”Ÿæˆæ–°çš„æ•Œäººå¹¶èµ‹å€¼ç»™ enemy
        function moveEnemy() { 
            const enemy = document.querySelector("#enemy");    
            const enemyRect = enemy.getBoundingClientRect();                 
            const newX = enemyRect.left + player.offsetWidth / 2 + deltaX;

            // è¶…å‡ºè¾¹ç•ŒæŠ˜è¿”æ–¹å‘
            if (newX >= 0 && newX + 25 <= window.innerWidth) {
                enemy.style.left = newX + deltaX + "px";
            }
            if (newX - 25 < 0 ) {
                deltaX = 2;
                }
            if (newX + 25 > window.innerWidth) {
                deltaX = -2;
                } 
                
        }
        
        setInterval(moveEnemy, 50); // æ¯ 100 æ¯«ç§’ç§»åŠ¨ä¸€æ¬¡

    // å®šä¹‰åˆå§‹åˆ†æ•°
    let score = 0;

    // å‡½æ•°ç”¨äºæ›´æ–°è®¡åˆ†å™¨æ˜¾ç¤º
    function updateScore() {
        const scoreElement = document.getElementById("score");
        scoreElement.textContent = "Score: " + score;
    }

    // å‡½æ•°ç”¨äºå¢åŠ åˆ†æ•°
    function increaseScore() {
        score += 1; // å¢åŠ  1 åˆ†
        updateScore(); // æ›´æ–°è®¡åˆ†å™¨æ˜¾ç¤º
        
    }

    </script>
</body>

</html>